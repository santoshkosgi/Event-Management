<% content_for :header do %>
  <h1><%= @event.name %></h1>
<% end %>
<div style="float:right">
<script charset="utf-8" src="http://widgets.twimg.com/j/2/widget.js"></script>
<script>
new TWTR.Widget({
  version: 2,
  type: 'profile',
  rpp: 4,
  interval: 30000,
  width: 250,
  height: 300,
  theme: {
    shell: {
      background: '#333333',
      color: '#ffffff'
    },
    tweets: {
      background: '#000000',
      color: '#ffffff',
      links: '#4aed05'
    }
  },
  features: {
    scrollbar: false,
    loop: false,
    live: false,
    behavior: 'all'
  }
}).render().setUser('<%= @event.name%>').start();
</script>
</div>
<h3>When and Where </h3>
<%= @event.date %> <%= "at" %> <%= @event.time %>:<%=@event.min%>
</br>
<h3>Venue</h3>
<%= @event.location %>
</br>
<h3>Event Details</h3>
<%= @event.description %></br>

<h3>Registration</h3>
<% if current_user %>
  <% if is_registered_already? @event.id %>
   <p> registered already </p>
  <% else %>
    <br/>
    <h3>Ticket Information</h3>
    <table>
      <tr>
        <th>Ticket Type</th>
        <th>Sales End</th>
        <th>Price</th>
        <th>Quantity</th>
      </tr>
      <tr>
        <td>General</td>
        <td><%= @event.date %></td>
        <td>300</td>
        <%= form_tag "/events/attend", :method => 'post' do %>
            <%= hidden_field_tag(:event_id,@event.id) %>
            <td><%=select_tag(:num, options_for_select((0..40).collect {|s| ["#{s}", s]}))%></td></tr></table>
            <%= hidden_field_tag(:valid,"notvalid") %>
            <%= submit_tag("Register",:class=>"btn primary") %>
        <% end %>
        <%= form_tag coupons_path, :method => 'get',:id=>"form1" do %>
          <a href="#" id="coupon" style="font-family:arial;color:red;font-size:20px;">have a coupon code?</a>
          <div id="code"><p>enter the code</p>
            <input type=text name="coupon"><input type=submit id="codecheck" value="Apply" class="btn primary">
            <%= hidden_field_tag(:event_id,@event.id) %>
          </div>
        <% end %>
  <% end %>
  <% if is_organisor? %>
    <%= link_to "Check The Attendees", :controller => "events" ,:action => "attendees",:id => @event.id %>
  <% end %>
  <% if current_user.authorizations.empty?%>
    <h3>Please SignIn through LinkedIn to see people from your connections attending this event</h3>
  <% end %>
  <div id="connectionheader"></div>
  <div id="connections"></div>
  <div id="start" style="float:right;width: 180px;padding:0px 175px 0px 0px"></div>
  <% if current_user.authorizations.empty?%>
  <% else %>
  <%= form_tag "/events/connection", :method => 'get',:id=>"form_connections" do %>
      <input type=submit id="codecheck" value="check attendees from your connection" class="btn primary">
      <%= hidden_field_tag(:event_id,@event.id) %>
  <% end %>
  <%end%>
<% end %>
<% content_for :contactor do %>
  <button class="btn btn-info">Add to Google Calender</button><br/><br/>
  <button class="btn btn-info">Contact Organisor</button>
<% end %>

<script type="text/javascript">
  $(document).ready(function () {
    $("#code").hide()
    $("#coupon").click(function(){
      $(this).hide()
      $("#code").show()
    })

    $("#form1").submit(function(e){
      e.preventDefault()
        $.ajax({
          url: $('#form1').attr('action'),
          dataType: "script",
          type: "get",
          data: $('#form1').serialize()
        })
    })

    $("#form_connections").submit(function(e){
      $("#start").html("<img src='/assets/ajax-loader.gif' />")
      e.preventDefault()
        $.ajax({
          url: $('#form_connections').attr('action'),
          complete: function() {
            $('#start').html('')
          },
          dataType: "script",
          type: "get",
          data: $('#form_connections').serialize()
        })
    })

  })
  </script>
